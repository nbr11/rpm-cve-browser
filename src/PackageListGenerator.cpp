#include "PackageListGenerator.hpp"

#include <QProcess>

PackageListGenerator::PackageListGenerator(QObject *parent)
  : QObject(parent)
    , m_pProcess(new QProcess(this))
{
    connect(m_pProcess, SIGNAL(started()), this, SIGNAL(started()));
    connect(m_pProcess, SIGNAL(finished(int)), this, SIGNAL(finished()));

    connect(m_pProcess, SIGNAL(readyRead()), this, SLOT(onReadReady()));
    // m_pProcess->setProcessChannelMode(QProcess::ForwardedChannels);
}

void PackageListGenerator::start()
{
    QString program("rpm");
    QStringList args;
    args.append("-qa");

    qDebug("Start");

    m_pProcess->start(program, args);
}

void PackageListGenerator::onReadReady()
{
    while (m_pProcess->canReadLine())
    {
        QString line = m_pProcess->readLine();
        emit item(line.mid(0, line.lastIndexOf('-', line.lastIndexOf('-')-1)));
    }
}
